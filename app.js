const translations = {
    en: {
        subtitle: "Add #FREEYAMP to your images to show your support!",
        uploadImage: "Upload Image",
        uploadText: "Drag image here or click to select",
        uploadHint: "PNG, JPG, GIF supported",
        settings: "Settings",
        textColor: "Text Color",
        bgColor: "Background Color",
        bgOpacity: "Background Opacity",
        overlayOpacity: "Text/Logo Opacity",
        overlaySize: "Text/Logo Size",
        changeImage: "Change Image",
        download: "Download",
        preview: "Preview",
        footerText: "Made with love for the YAMP community",
        developedBy: "Developed by",
        aboutProject: "About This Project",
        infoTitle: "What is YAMP?",
        infoDesc1: "Yet Another M Platform (YAMP) is an independent, nonprofit, third-party modding project focused on delivering high-quality multiplayer experiences driven by its community.",
        infoDesc2: "Recently, the YAMP team received a formal Cease & Desist notice from Take-Two Interactive. Following this, the project's developers decided to temporarily pause development while engaging in good-faith communication to seek clarification and explore a possible resolution.",
        infoDesc3: "Throughout its existence, YAMP has remained free and non-commercial, with no monetization or donation systems. The team has consistently emphasized transparency and community-driven development.",
        infoWhyTitle: "Why #FREEYAMP?",
        infoWhyDesc: "This tool was created as a community support and awareness initiative. Its sole purpose is to allow supporters to add a #FREEYAMP overlay to images in order to express solidarity with the YAMP community and highlight the importance of open dialogue around modding, creativity, and community-driven projects.",
        infoDisclaimer: "This repository is not affiliated with Take-Two Interactive or Rockstar Games, and it does not host, distribute, or modify any game files. It is a fan-made, informational tool created to support community expression."
    },
    de: {
        subtitle: "Fügen Sie #FREEYAMP zu Ihren Bildern hinzu, um Ihre Unterstützung zu zeigen!",
        uploadImage: "Bild Hochladen",
        uploadText: "Bild hierher ziehen oder klicken zum Auswählen",
        uploadHint: "PNG, JPG, GIF unterstützt",
        settings: "Einstellungen",
        textColor: "Textfarbe",
        bgColor: "Hintergrundfarbe",
        bgOpacity: "Hintergrund-Deckkraft",
        overlayOpacity: "Text/Logo-Deckkraft",
        overlaySize: "Text/Logo-Größe",
        changeImage: "Bild Ändern",
        download: "Herunterladen",
        preview: "Vorschau",
        footerText: "Mit Liebe für die YAMP-Community gemacht",
        developedBy: "Entwickelt von",
        aboutProject: "Über dieses Projekt",
        infoTitle: "Was ist YAMP?",
        infoDesc1: "Yet Another M Platform (YAMP) ist ein unabhängiges, gemeinnütziges Modding-Projekt, das sich auf hochwertige Multiplayer-Erlebnisse konzentriert, die von der Community vorangetrieben werden.",
        infoDesc2: "Kürzlich erhielt das YAMP-Team eine formelle Unterlassungserklärung von Take-Two Interactive. Daraufhin beschlossen die Entwickler, die Entwicklung vorübergehend zu pausieren und in gutem Glauben nach einer Klärung und möglichen Lösung zu suchen.",
        infoDesc3: "Während seiner gesamten Existenz blieb YAMP kostenlos und nicht-kommerziell, ohne Monetarisierung oder Spendensysteme. Das Team hat stets Transparenz und Community-getriebene Entwicklung betont.",
        infoWhyTitle: "Warum #FREEYAMP?",
        infoWhyDesc: "Dieses Tool wurde als Community-Unterstützungs- und Sensibilisierungsinitiative erstellt. Sein einziger Zweck ist es, Unterstützern zu ermöglichen, ein #FREEYAMP-Overlay zu Bildern hinzuzufügen, um Solidarität mit der YAMP-Community auszudrücken.",
        infoDisclaimer: "Dieses Repository ist nicht mit Take-Two Interactive oder Rockstar Games verbunden und hostet, verteilt oder modifiziert keine Spieldateien. Es ist ein von Fans erstelltes, informatives Tool zur Unterstützung der Community-Expression."
    },
    tr: {
        subtitle: "Resimlerinize #FREEYAMP ekleyin, desteğinizi gösterin!",
        uploadImage: "Resim Yükle",
        uploadText: "Resmi buraya sürükleyin veya seçmek için tıklayın",
        uploadHint: "PNG, JPG, GIF desteklenir",
        settings: "Ayarlar",
        textColor: "Yazı Rengi",
        bgColor: "Arka Plan Rengi",
        bgOpacity: "Arka Plan Şeffaflığı",
        overlayOpacity: "Yazı/Logo Şeffaflığı",
        overlaySize: "Yazı/Logo Boyutu",
        changeImage: "Resmi Değiştir",
        download: "İndir",
        preview: "Önizleme",
        footerText: "YAMP topluluğu için sevgiyle yapılmıştır",
        developedBy: "Geliştirici",
        aboutProject: "Bu Proje Hakkında",
        infoTitle: "YAMP Nedir?",
        infoDesc1: "Yet Another M Platform (YAMP), topluluk tarafından yönlendirilen yüksek kaliteli çok oyunculu deneyimler sunmaya odaklanan bağımsız, kâr amacı gütmeyen bir modding projesidir.",
        infoDesc2: "Son zamanlarda YAMP ekibi, Take-Two Interactive'den resmi bir Durdurma ve Vazgeçme bildirimi aldı. Bunun üzerine geliştiriciler, açıklama aramak ve olası bir çözümü keşfetmek için iyi niyetli iletişime geçerken geliştirmeyi geçici olarak durdurma kararı aldı.",
        infoDesc3: "YAMP, varlığı boyunca ücretsiz ve ticari olmayan kalmış, hiçbir para kazanma veya bağış sistemi olmamıştır. Ekip her zaman şeffaflığı ve topluluk odaklı geliştirmeyi vurgulamıştır.",
        infoWhyTitle: "Neden #FREEYAMP?",
        infoWhyDesc: "Bu araç, bir topluluk desteği ve farkındalık girişimi olarak oluşturuldu. Tek amacı, destekleyicilerin YAMP topluluğuyla dayanışmayı ifade etmek için görüntulerine #FREEYAMP eklemelerine olanak tanımaktır.",
        infoDisclaimer: "Bu depo Take-Two Interactive veya Rockstar Games ile bağlantılı değildir ve hiçbir oyun dosyasını barındırmaz, dağıtmaz veya değiştirmez. Topluluk ifadesini desteklemek için oluşturulmuş hayran yapımı bir araçtır."
    },
    fr: {
        subtitle: "Ajoutez #FREEYAMP à vos images pour montrer votre soutien!",
        uploadImage: "Télécharger l'Image",
        uploadText: "Faites glisser l'image ici ou cliquez pour sélectionner",
        uploadHint: "PNG, JPG, GIF pris en charge",
        settings: "Paramètres",
        textColor: "Couleur du Texte",
        bgColor: "Couleur de Fond",
        bgOpacity: "Opacité du Fond",
        overlayOpacity: "Opacité Texte/Logo",
        overlaySize: "Taille Texte/Logo",
        changeImage: "Changer l'Image",
        download: "Télécharger",
        preview: "Aperçu",
        footerText: "Fait avec amour pour la communauté YAMP",
        developedBy: "Développé par",
        aboutProject: "À propos de ce projet",
        infoTitle: "Qu'est-ce que YAMP?",
        infoDesc1: "Yet Another M Platform (YAMP) est un projet de modding indépendant et à but non lucratif axé sur des expériences multijoueurs de haute qualité dirigées par sa communauté.",
        infoDesc2: "Récemment, l'équipe YAMP a reçu un avis formel de cessation de Take-Two Interactive. Suite à cela, les développeurs ont décidé de suspendre temporairement le développement tout en engageant une communication de bonne foi.",
        infoDesc3: "Tout au long de son existence, YAMP est resté gratuit et non commercial, sans système de monétisation ou de don. L'équipe a toujours mis l'accent sur la transparence et le développement axé sur la communauté.",
        infoWhyTitle: "Pourquoi #FREEYAMP?",
        infoWhyDesc: "Cet outil a été créé comme une initiative de soutien et de sensibilisation communautaire. Son seul but est de permettre aux supporters d'ajouter un overlay #FREEYAMP aux images pour exprimer leur solidarité avec la communauté YAMP.",
        infoDisclaimer: "Ce dépôt n'est pas affilié à Take-Two Interactive ou Rockstar Games, et il n'héberge, ne distribue ni ne modifie aucun fichier de jeu. C'est un outil créé par des fans pour soutenir l'expression communautaire."
    }
};

let currentLanguage = localStorage.getItem('freeyamp_lang') || 'en';

function setLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('freeyamp_lang', lang);
    document.documentElement.lang = lang;

    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            el.textContent = translations[lang][key];
        }
    });
}

document.addEventListener('DOMContentLoaded', function () {
    const uploadSection = document.getElementById('uploadSection');
    const editorSection = document.getElementById('editorSection');
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const previewCanvas = document.getElementById('previewCanvas');
    const downloadBtn = document.getElementById('downloadBtn');
    const changeImageBtn = document.getElementById('changeImageBtn');
    const textColorInput = document.getElementById('textColor');
    const bgColorInput = document.getElementById('bgColor');
    const bgOpacityInput = document.getElementById('bgOpacity');
    const overlayOpacityInput = document.getElementById('overlayOpacity');
    const overlaySizeInput = document.getElementById('overlaySize');
    const bgOpacityValue = document.getElementById('bgOpacityValue');
    const overlayOpacityValue = document.getElementById('overlayOpacityValue');
    const overlaySizeValue = document.getElementById('overlaySizeValue');
    const languageSelect = document.getElementById('languageSelect');

    const ctx = previewCanvas.getContext('2d');
    let uploadedImage = null;
    let yampLogo = null;

    yampLogo = new Image();
    yampLogo.crossOrigin = 'anonymous';
    yampLogo.src = './images/yamp_transperent.png';

    languageSelect.value = currentLanguage;
    setLanguage(currentLanguage);

    languageSelect.addEventListener('change', function () {
        setLanguage(this.value);
    });

    const infoToggle = document.getElementById('infoToggle');
    const infoContent = document.getElementById('infoContent');
    infoToggle.addEventListener('click', function () {
        this.classList.toggle('active');
        infoContent.classList.toggle('active');
    });

    uploadArea.addEventListener('click', function () {
        fileInput.click();
    });

    uploadArea.addEventListener('dragover', function (e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', function () {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', function (e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
            handleImageUpload(file);
        }
    });

    fileInput.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
            handleImageUpload(file);
        }
    });

    function handleImageUpload(file) {
        const reader = new FileReader();
        reader.onload = function (e) {
            uploadedImage = new Image();
            uploadedImage.onload = function () {
                uploadSection.style.display = 'none';
                editorSection.style.display = 'block';
                generateOverlay();
            };
            uploadedImage.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    changeImageBtn.addEventListener('click', function () {
        uploadedImage = null;
        fileInput.value = '';
        editorSection.style.display = 'none';
        uploadSection.style.display = 'block';
    });

    bgOpacityInput.addEventListener('input', function () {
        bgOpacityValue.textContent = this.value + '%';
        generateOverlay();
    });

    overlayOpacityInput.addEventListener('input', function () {
        overlayOpacityValue.textContent = this.value + '%';
        generateOverlay();
    });

    overlaySizeInput.addEventListener('input', function () {
        overlaySizeValue.textContent = this.value + '%';
        generateOverlay();
    });

    textColorInput.addEventListener('input', function () {
        generateOverlay();
    });

    bgColorInput.addEventListener('input', function () {
        generateOverlay();
    });

    function generateOverlay() {
        if (!uploadedImage) return;

        previewCanvas.width = uploadedImage.width;
        previewCanvas.height = uploadedImage.height;
        ctx.drawImage(uploadedImage, 0, 0);

        const textColor = textColorInput.value;
        const bgColor = bgColorInput.value;
        const bgOpacity = bgOpacityInput.value / 100;
        const overlayOpacity = overlayOpacityInput.value / 100;
        const sizeMultiplier = overlaySizeInput.value / 100;

        const centerX = previewCanvas.width / 2;
        const centerY = previewCanvas.height / 2;

        const baseFontSize = Math.min(previewCanvas.width, previewCanvas.height) * 0.12;
        const fontSize = baseFontSize * sizeMultiplier;
        ctx.font = 'bold ' + fontSize + 'px "Segoe UI", Tahoma, Geneva, Verdana, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        const text = '#FREEYAMP';
        const textMetrics = ctx.measureText(text);
        const textHeight = fontSize;

        const logoHeight = fontSize * 1.5;
        const logoWidth = yampLogo.width * (logoHeight / yampLogo.height);

        const totalHeight = textHeight + 20 + logoHeight;

        ctx.globalAlpha = bgOpacity;
        ctx.fillStyle = bgColor;
        ctx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);

        ctx.globalAlpha = overlayOpacity;

        ctx.fillStyle = textColor;
        const textY = centerY - (totalHeight / 2) + (textHeight / 2);
        ctx.fillText(text, centerX, textY);

        if (yampLogo.complete && yampLogo.naturalWidth > 0) {
            const logoX = centerX - logoWidth / 2;
            const logoY = textY + textHeight / 2 + 20;

            ctx.drawImage(yampLogo, logoX, logoY, logoWidth, logoHeight);
        }

        ctx.globalAlpha = 1;
    }

    downloadBtn.addEventListener('click', function () {
        if (!uploadedImage) return;

        const link = document.createElement('a');
        link.download = 'freeyamp_image.png';
        link.href = previewCanvas.toDataURL('image/png');
        link.click();
    });
});
